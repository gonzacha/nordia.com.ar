<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nordia Bot - Demo en Vivo</title>
    <style>
        :root {
            --wa-teal: #00a884;
            --wa-teal-dark: #008069;
            --wa-bg: #0a1929;
            --wa-panel: #111b27;
            --wa-message-out: #005c4b;
            --wa-message-in: #1f2c34;
            --wa-text: #e9edef;
            --wa-text-secondary: #8696a0;
            --wa-input-bg: #2a3942;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--wa-bg);
            height: 100vh;
            overflow: hidden;
            color: var(--wa-text);
        }

        /* Mobile-first: Stack vertical completo */
        .chat-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--wa-panel);
        }

        /* Header limpio y moderno */
        .chat-header {
            background: linear-gradient(135deg, var(--wa-teal-dark) 0%, var(--wa-teal) 100%);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            position: relative;
            z-index: 10;
        }

        .avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .header-info {
            flex: 1;
        }

        .header-info h1 {
            font-size: 17px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
        }

        .header-info .status {
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .reset-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }

        .reset-btn:active {
            background: rgba(255,255,255,0.25);
            transform: scale(0.95);
        }

        /* Messages area con gradiente sutil */
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 16px;
            background:
                linear-gradient(180deg, var(--wa-panel) 0%, #0d1520 100%);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Custom scrollbar */
        .messages::-webkit-scrollbar {
            width: 4px;
        }

        .messages::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
        }

        /* Messages con animaci√≥n m√°s fluida */
        .message {
            max-width: 85%;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 15px;
            line-height: 1.5;
            position: relative;
            word-wrap: break-word;
            white-space: pre-wrap;
            animation: slideIn 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message--bot {
            background: var(--wa-message-in);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .message--user {
            background: var(--wa-message-out);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .message-time {
            display: block;
            font-size: 11px;
            color: var(--wa-text-secondary);
            margin-top: 4px;
            text-align: right;
        }

        /* Input area mejorada */
        .input-area {
            background: var(--wa-panel);
            padding: 12px 16px 12px 16px;
            padding-bottom: max(12px, env(safe-area-inset-bottom));
            display: flex;
            gap: 8px;
            align-items: center;
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .input-wrapper {
            flex: 1;
            background: var(--wa-input-bg);
            border-radius: 24px;
            padding: 10px 18px;
            display: flex;
            align-items: center;
            transition: all 0.2s;
        }

        .input-wrapper:focus-within {
            background: #36414a;
        }

        input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            color: var(--wa-text);
            font-size: 16px;
            font-family: inherit;
        }

        input::placeholder {
            color: var(--wa-text-secondary);
        }

        .send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--wa-teal);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,168,132,0.3);
        }

        .send-btn:active {
            transform: scale(0.9);
            background: var(--wa-teal-dark);
        }

        .send-btn svg {
            width: 22px;
            height: 22px;
            fill: white;
        }

        /* Badge de demo */
        .demo-badge {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            backdrop-filter: blur(10px);
        }

        /* Tablet y Desktop */
        @media (min-width: 768px) {
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
            }

            .chat-container {
                max-width: 480px;
                height: 720px;
                border-radius: 16px;
                overflow: hidden;
                box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            }

            .reset-btn:hover {
                background: rgba(255,255,255,0.25);
            }

            .send-btn:hover {
                background: var(--wa-teal-dark);
            }
        }

        /* Landscape mobile fix */
        @media (max-height: 500px) and (orientation: landscape) {
            .chat-header {
                padding: 10px 16px;
            }

            .messages {
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <header class="chat-header">
            <div class="avatar">N</div>
            <div class="header-info">
                <h1>Nordia</h1>
                <div class="status">
                    <span class="status-dot"></span>
                    En l√≠nea
                </div>
            </div>
            <button class="reset-btn" id="resetBtn">Reiniciar</button>
        </header>

        <div class="messages" id="messages"></div>

        <div class="input-area">
            <div class="input-wrapper">
                <input
                    type="text"
                    id="input"
                    placeholder="Escribe un mensaje..."
                    autocomplete="off"
                    autocapitalize="off"
                    spellcheck="false"
                >
            </div>
            <button class="send-btn" id="sendBtn">
                <svg viewBox="0 0 24 24">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // Clear storage on load for clean demo
        localStorage.clear();

        const STATES = {
            INICIAL: 'inicial',
            ESP_NOMBRE: 'esperando_nombre',
            ESP_HORARIOS: 'esperando_horarios',
            ESP_SERVICIOS: 'esperando_servicios',
            COMPLETADO: 'completado',
            ESP_FECHA: 'esperando_fecha_turno',
            ESP_HORA: 'esperando_hora_turno'
        };

        const KEYWORDS = {
            SETUP: 'setup',
            SERVICIOS: ['precio', 'precios', 'servicio', 'servicios', 'cuanto', 'cuesta', 'cuestan', 'sale', 'salen'],
            TURNOS: ['turno', 'turnos', 'reserva', 'reservar', 'cita']
        };

        const MESSAGES = {
            WELCOME: "Hola! üëã Soy Nordia.\nEscribe 'setup' para comenzar.",
            ASK_NAME: "Perfecto üëç ¬øC√≥mo se llama tu negocio?",
            ASK_HOURS: "Genial. ¬øCu√°les son tus horarios de atenci√≥n?",
            ASK_SERVICES: "¬øQu√© servicios ofreces?",
            SETUP_DONE: (data) => `‚úÖ Listo! Guard√©:\n\nüìç Negocio: ${data.nombre}\n‚è∞ Horarios: ${data.horarios}\nüíº Servicios:\n${data.servicios}\n\nEscribe SERVICIOS para ver precios o TURNO para reservar.`,
            ASK_DATE: "Perfecto üëç ¬øPara qu√© d√≠a?",
            ASK_TIME: "¬øA qu√© hora?",
            CONFIRM_BOOKING: (date, time) => `‚úÖ Turno reservado para ${date} a las ${time}`,
            FALLBACK: "¬°Hola! Escribe SERVICIOS para ver precios o TURNO para reservar.",
            INVALID_NAME: "‚ùå El nombre debe tener al menos 3 caracteres y no puede ser solo n√∫meros.",
            INVALID_HOURS: "‚ùå Los horarios deben contener n√∫meros y letras (ej: Lun-Vie 9-18hs).",
            SHOW_SERVICES: (serv) => `Estos son nuestros servicios:\n\n${serv}`
        };

        // Store
        class Store {
            constructor() {
                this.data = {
                    estado: STATES.INICIAL,
                    nombre: null,
                    horarios: null,
                    servicios: null,
                    turnos: [],
                    turno_temp: { fecha: null },
                    messages: []
                };
            }

            update(updates) {
                this.data = { ...this.data, ...updates };
            }

            reset() {
                this.data = {
                    estado: STATES.INICIAL,
                    nombre: null,
                    horarios: null,
                    servicios: null,
                    turnos: [],
                    turno_temp: { fecha: null },
                    messages: []
                };
            }

            addMessage(text, sender = 'bot') {
                const msg = {
                    id: Date.now(),
                    text,
                    sender,
                    time: new Date().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' })
                };
                this.data.messages.push(msg);
            }
        }

        // Bot Engine
        class BotEngine {
            constructor(store) {
                this.store = store;
            }

            process(inputText) {
                const state = this.store.data.estado;
                const raw = inputText.trim();
                const lower = raw.toLowerCase();

                switch (state) {
                    case STATES.INICIAL:
                        if (lower === KEYWORDS.SETUP) {
                            this.store.update({ estado: STATES.ESP_NOMBRE });
                            this.store.addMessage(MESSAGES.ASK_NAME, 'bot');
                        } else {
                            this.store.addMessage(MESSAGES.WELCOME, 'bot');
                        }
                        break;

                    case STATES.ESP_NOMBRE:
                        if (this.validateName(raw)) {
                            this.store.update({ nombre: raw, estado: STATES.ESP_HORARIOS });
                            this.store.addMessage(MESSAGES.ASK_HOURS, 'bot');
                        } else {
                            this.store.addMessage(MESSAGES.INVALID_NAME, 'bot');
                        }
                        break;

                    case STATES.ESP_HORARIOS:
                        if (this.validateHours(raw)) {
                            this.store.update({ horarios: raw, estado: STATES.ESP_SERVICIOS });
                            this.store.addMessage(MESSAGES.ASK_SERVICES, 'bot');
                        } else {
                            this.store.addMessage(MESSAGES.INVALID_HOURS, 'bot');
                        }
                        break;

                    case STATES.ESP_SERVICIOS:
                        if (raw.length > 0) {
                            this.store.update({ servicios: raw, estado: STATES.COMPLETADO });
                            this.store.addMessage(MESSAGES.SETUP_DONE(this.store.data), 'bot');
                        }
                        break;

                    case STATES.COMPLETADO:
                        if (KEYWORDS.TURNOS.some(kw => lower.includes(kw))) {
                            this.store.update({ estado: STATES.ESP_FECHA });
                            this.store.addMessage(MESSAGES.ASK_DATE, 'bot');
                        } else if (KEYWORDS.SERVICIOS.some(kw => lower.includes(kw))) {
                            this.store.addMessage(MESSAGES.SHOW_SERVICES(this.store.data.servicios), 'bot');
                        } else {
                            this.store.addMessage(MESSAGES.FALLBACK, 'bot');
                        }
                        break;

                    case STATES.ESP_FECHA:
                        this.store.update({
                            turno_temp: { fecha: raw },
                            estado: STATES.ESP_HORA
                        });
                        this.store.addMessage(MESSAGES.ASK_TIME, 'bot');
                        break;

                    case STATES.ESP_HORA:
                        const turno = {
                            fecha: this.store.data.turno_temp.fecha,
                            hora: raw
                        };
                        this.store.data.turnos.push(turno);
                        this.store.update({
                            turno_temp: { fecha: null },
                            estado: STATES.COMPLETADO
                        });
                        this.store.addMessage(MESSAGES.CONFIRM_BOOKING(turno.fecha, turno.hora), 'bot');
                        break;
                }
            }

            validateName(text) {
                return text.length >= 3 && isNaN(text);
            }

            validateHours(text) {
                return /\d/.test(text) && /[a-zA-Z]/.test(text);
            }
        }

        // UI
        class UI {
            constructor(store, bot) {
                this.store = store;
                this.bot = bot;
                this.elements = {
                    messages: document.getElementById('messages'),
                    input: document.getElementById('input'),
                    sendBtn: document.getElementById('sendBtn'),
                    resetBtn: document.getElementById('resetBtn')
                };
                this.bindEvents();
                this.render();
            }

            bindEvents() {
                const send = () => {
                    const text = this.elements.input.value.trim();
                    if (!text) return;

                    this.store.addMessage(text, 'user');
                    this.elements.input.value = '';
                    this.render();

                    setTimeout(() => {
                        this.bot.process(text);
                        this.render();
                    }, 400);
                };

                this.elements.sendBtn.addEventListener('click', send);
                this.elements.input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') send();
                });

                this.elements.resetBtn.addEventListener('click', () => {
                    this.store.reset();
                    this.store.addMessage(MESSAGES.WELCOME, 'bot');
                    this.render();
                });
            }

            render() {
                this.elements.messages.innerHTML = '';

                this.store.data.messages.forEach(msg => {
                    const div = document.createElement('div');
                    div.className = `message message--${msg.sender}`;
                    div.innerHTML = `${this.escapeHtml(msg.text)}<span class="message-time">${msg.time}</span>`;
                    this.elements.messages.appendChild(div);
                });

                this.elements.messages.scrollTop = this.elements.messages.scrollHeight;
                this.elements.input.focus();
            }

            escapeHtml(text) {
                return text
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            const store = new Store();
            const bot = new BotEngine(store);

            // Show welcome message immediately
            store.addMessage(MESSAGES.WELCOME, 'bot');

            new UI(store, bot);
        });
    </script>
</body>
</html>
